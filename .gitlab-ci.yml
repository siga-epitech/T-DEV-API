stages:
  - trigger_devops
  - trigger_dev
  - trigger_prod

trigger_devops_dev:
  stage: trigger_dev
  tags:
    - sigaRunner
  script:
    - echo "Triggering pipeline in DevOps repository..."
    - |
      curl -X POST --fail \
           -F token=${SIGA_DEVOPS_TRIGGER_TOKEN} \
           -F ref=dev \
           -F "variables[ENVIRONMENT]=dev" \
           https://t-dev.epitest.eu/api/v4/projects/718/trigger/pipeline \
      || echo "Failed to trigger Dev pipeline."
  only:
    - feature/ci-config
   #- dev

trigger_devops_prod:
  stage: trigger_prod
  tags:
    - sigaRunner
  script:
    - echo "Triggering pipeline in DevOps repository..."
    - |
      curl -X POST --fail \
           -F token=${SIGA_DEVOPS_TRIGGER_TOKEN} \
           -F ref=prod \
           -F "variables[ENVIRONMENT]=prod" \
           https://t-dev.epitest.eu/api/v4/projects/718/trigger/pipeline \
      || echo "Failed to trigger Prod pipeline."
  only:
    - feature/ci-config
   #- prod
  



trigger_devops_pipelines:
  stage: trigger_devops
  tags:
    - sigaRunner
  script:
    - echo "Triggering pipeline in DevOps repository..."
    - |
      curl -X POST --fail \
           -F token=${SIGA_DEVOPS_TRIGGER_TOKEN} \
           -F ref=feature/docker-configuration-siga \
           -F "variables[ENVIRONMENT]=prod" \
           https://t-dev.epitest.eu/api/v4/projects/718/trigger/pipeline \
      || echo "Failed to trigger DevOps pipeline."
  only:
    - feature/ci-config
   #- prod


  # Changer aussi la branche de Ref, car en realit√© on veux que le trigger ici active les jobs de dev donc on trigger les jobs de dev
  # Changer la valeur de 718 (qui est l'id du repos) par une variable d'environnement
  




